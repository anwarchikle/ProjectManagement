<template>
    <div class="full-screen">
        <!-- Header Section with Filters and Actions -->
         <br></br>
        <div class="header-container">
            <!-- Left Side: Filters -->
            <div class="header-left">
                <div class="filter-group">
                    <lightning-combobox 
                        name="projectFilter" 
                        label="Project" 
                        value={selectedProjectId}
                        options={projectOptions} 
                        onchange={handleProjectFilterChange}
                        class="filter-combo">
                    </lightning-combobox>
                </div>
                
                <div class="filter-group">
                    <lightning-combobox 
                        name="milestoneFilter" 
                        label="Milestone" 
                        value={selectedMilestoneId}
                        options={milestoneOptions} 
                        onchange={handleMilestoneFilterChange} 
                        disabled={isProjectNotSelected}
                        class="filter-combo">
                    </lightning-combobox>
                </div>
                
                <div class="filter-group">
                    <lightning-combobox 
                        name="taskListFilter" 
                        label="Task List" 
                        value={selectedTaskListId}
                        options={taskListOptions} 
                        onchange={handleTaskListFilterChange} 
                        disabled={isProjectNotSelected}
                        class="filter-combo">
                    </lightning-combobox>
                </div>
            </div>

            <!-- Right Side: Actions -->
            <div class="header-right">
                <lightning-button-icon 
                    icon-name="utility:refresh" 
                    variant="bare" 
                    alternative-text="Reset filters"
                    title="Reset filters" 
                    onclick={handleResetFilters} 
                    class="action-btn refresh-btn">
                </lightning-button-icon>
                
                <div class="filter-group view-filter">
                    <lightning-combobox 
                        name="dateFilter" 
                        label="View" 
                        value={selectedDateFilter}
                        options={dateFilterOptions} 
                        onchange={handleDateFilterChange}
                        class="filter-combo">
                    </lightning-combobox>
                </div>
                
                <!-- <lightning-button 
                    variant="Brand" 
                    label="New Project" 
                    title="Create New Project" 
                    onclick={createNewProject}
                    class="new-project-btn">
                </lightning-button> -->
                <button 
                    class="custom-new-project-btn" 
                    onclick={createNewProject}
                    title="Create New Project">
                    <span class="btn-icon">+</span>
                    <span class="btn-text">New Project</span>
                </button>
            </div>
        </div>

        <!-- Main Table Container -->
        <div class="table-container">
            <!-- Fixed Columns (Left Side) -->
            <div class="fixed-columns">
                <table class="tree-table">
                    <colgroup>
                        <col style="width: 100px;">  <!-- Actions -->
                        <col style="width: 60px;">   <!-- Sequence -->
                        <col style="width: 40px;">   <!-- Icon -->
                        <col style="width: 16rem;">  <!-- Name -->
                        <col style="width: 7rem; min-width: 110px;">  <!-- Status -->
                        <col style="width: 6rem;">  <!-- Completion -->
                        <col style="width: 140px;">  <!-- Estimated Hours -->
                        <col style="width: 120px;">  <!-- Logged Hours -->
                    </colgroup>
                    <thead>
                        <tr>
                            <th class="actions">Actions</th>
                            <th class="sequence">#</th>
                            <th class="icon"></th>
                            <th class="name">Name</th>
                            <th>Status</th>
                            <th>Completion</th>
                            <th>Estimated Hours</th>
                            <th>Logged Hours</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={visibleRows} for:item="row">
                            <tr key={row.Id}>
                                <td class="actions">
                                    <lightning-button-icon icon-name="utility:edit" variant="bare" data-id={row.Id}
                                        onclick={handleEdit} title="Edit">
                                    </lightning-button-icon>
                                    &nbsp;
                                    <lightning-button-icon icon-name="utility:add" variant="bare" data-id={row.Id}
                                        onclick={handleAdd} disabled={row.disableAdd} title={row.addTooltip}>
                                    </lightning-button-icon>
                                    &nbsp;
                                    <!-- <lightning-button-icon icon-name="utility:adduser" variant="bare" data-id={row.Id}
                                        onclick={handleUser} title="Assign User">
                                    </lightning-button-icon> -->
                                </td>

                                <td class="sequence">{row.sequence}</td>

                                <td class="icon" style={row.indentStyle}>
                                    <template if:true={row.hasChildren}>
                                        <lightning-button-icon icon-name={row.toggleIcon} size="small" variant="bare"
                                            data-id={row.Id} onclick={toggleRow}>
                                        </lightning-button-icon>
                                    </template>
                                </td>

                                <td class="name" style={row.indentStyle}>
                                    <a href="javascript:void(0);" data-id={row.Id} onclick={handleNavigate} title={row.Name}>
                                        {row.Name}
                                    </a>
                                </td>

                                <td><span class={row.statusClass}>{row.Status}</span></td>
                                <td class="completion-cell">{row.completion}</td>
                                <td class="hours-cell">{row.EstimatedHours}</td>
                                <td class="hours-cell">{row.LoggedHours}</td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>

            <!-- Gantt Chart (Right Side) -->
            <div class="gantt-container">
                <div class="gantt-scroll-wrapper">
                    <table class="gantt-table">
                        <thead>
                            <tr>
                                <th class="timeline-header">
                                    <div class="timeline-header-container">
                                        <div class="timeline-months">
                                            <template for:each={timelineMonths} for:item="month">
                                                <div key={month.name} class="timeline-month">
                                                    {month.name}
                                                </div>
                                            </template>
                                        </div>
                                        <!-- <div class="timeline-today-marker" if:true={todayPosition}>
                                            <div class="today-line" style="left: {todayPosition}%;"></div>
                                            <div class="today-label" style="left: {todayPosition}%;">Today</div>
                                        </div> -->
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <template for:each={visibleRows} for:item="row">
                                <tr key={row.Id}>
                                    <td class="timeline">
                                        <div class="timeline-container" style={row.timelineStyle}>
                                            <div class="timeline-bar" style={row.timelineBarStyle}
                                                title={row.timelineTitle}>
                                                <span class="timeline-label">{row.timelineLabel}</span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</template>